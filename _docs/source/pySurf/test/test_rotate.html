<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pyXsurf – test_rotate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">pyXsurf</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/vincenzooo/pyXsurf"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">pyXsurf</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core.html" class="sidebar-item-text sidebar-link">pyXsurf (formerly pyXTel)</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-by-step-rotate-function" id="toc-step-by-step-rotate-function" class="nav-link active" data-scroll-target="#step-by-step-rotate-function">Step by step rotate function</a></li>
  <li><a href="#rotate-and-rebin" id="toc-rotate-and-rebin" class="nav-link" data-scroll-target="#rotate-and-rebin">rotate and rebin</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/vincenzooo/pyXsurf/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<div class="cell" data-execution_count="227">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests for points routines</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2018/12/11 from test documentation for points module,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># most is removed. This investigates rotation of 2D arrays in order</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to develop correct 2D rotation functions.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># original notes (?not sure what was removed and what was not incorporated ever):</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># sphinx</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel must be reset and output cleared before use or before running</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sphinx (unless you know what you are doing).</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">## </span><span class="al">TODO</span><span class="co"> </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - sphinxuse _build for intermediate files (move to docs\_build)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># but save output in docs(or move it there).</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># - hide parts of code, add doc string above commands.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># - save the results in the noteook (this anyway will prevent </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   future executions, so maybe make a copy or a script to clear output</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   when sphinx is called).</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#matplotlib.use('Agg')</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#from pySurf.points import *</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Once deleted, variables cannot be recovered. Proceed (y/[n])? y
The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload</code></pre>
</div>
</div>
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell" data-execution_count="228">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> astropy.io <span class="im">import</span> fits</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataIO.fn_add_subfix <span class="im">import</span> fn_add_subfix</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataIO.span <span class="im">import</span> span, span_from_pixels</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataIO.outliers <span class="im">import</span> remove_outliers</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataIO.dicts <span class="im">import</span> strip_kw,pop_kw</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> map_coordinates</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> interpolate <span class="im">as</span> ip</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotting.captions <span class="im">import</span> legendbox</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotting.add_clickable_markers <span class="im">import</span> add_clickable_markers2</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.testSurfaces <span class="im">import</span> make_prof_legendre, make_surf_legendre</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.points <span class="im">import</span> points_in_poly,rotate_points</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.find_internal_rectangle <span class="im">import</span> find_internal_rectangle</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.data2D <span class="im">import</span> plot_data,rotate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#avoid the annoying inline figures </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plt.ioff()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="230">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#%qtconsole</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="593">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_rotate(a,rotang):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""use ndimage.rotate with different options to </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    rotate a shape clockwise of a given angle with resample flag on and off, compare results.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    There is no coordinates manipulation.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This is needed to understand how to handle axis in implementing rotation in data2D (data with axis).</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Note that rotation happens on pixels and it is mapped to pixels, so it is always integer."""</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    plt.close(<span class="st">'all'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    nx,ny <span class="op">=</span> a.shape</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ax1<span class="op">=</span>plt.subplot(<span class="dv">311</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    plt.imshow(a,origin<span class="op">=</span><span class="st">'lower'</span>,interpolation<span class="op">=</span><span class="st">'none'</span>)<span class="op">;</span>plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ax2<span class="op">=</span>plt.subplot(<span class="dv">312</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    a2<span class="op">=</span>ndimage.rotate(a,rotang,reshape<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    plt.imshow(a2,origin<span class="op">=</span><span class="st">'lower'</span>,interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"reshape=0; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    (plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    ax3<span class="op">=</span>plt.subplot(<span class="dv">313</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    a3<span class="op">=</span>ndimage.rotate(a,rotang,reshape<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    plt.imshow(a3,origin<span class="op">=</span><span class="st">'lower'</span>,interpolation<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"reshape=1; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.95</span>])</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">"expected projected side lengths </span><span class="sc">%.3f</span><span class="st">, </span><span class="sc">%.3f</span><span class="st">"</span><span class="op">%</span>(nx<span class="op">*</span>np.cos(rotang<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">+</span>ny<span class="op">*</span>np.sin(<span class="dv">15</span><span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>),ny<span class="op">*</span>np.cos(rotang<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">+</span>nx<span class="op">*</span>np.sin(rotang<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)))</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax1,ax2,ax3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>scipy.ndimage.interpolation.rotate</code> with different options. Original data (top) is a rectangle of 2’s (green) in a rectangle of 1’s (blue). When image is rotated, 0 is used as fill value (can be set with parameter <code>cval</code>) for points out of the original image. <code>reshape</code> controls if the rotated data are cropped after rotation to match original range (<code>reshape = False</code>).</p>
<p>A small square of 3’s (yellow) is inserted at coordinates [10:15,20:25] to identify axis orientation by marking the corner closer to 0 in x and y (imshow must be called with origin=‘lower’ to orient axis as cartesian, and also to put axis limits in increasing order). Four central pixels are marked with a value of 10, as well as the single point at 20,10.</p>
<p>This is automatically handled in <code>pySurf.data2D</code> functions.</p>
<div class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build test array</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>nx,ny<span class="op">=</span><span class="dv">100</span>,<span class="dv">50</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>np.ones(nx<span class="op">*</span>ny).reshape((ny,nx))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">10</span>:<span class="op">-</span><span class="dv">10</span>,<span class="dv">20</span>:<span class="op">-</span><span class="dv">20</span>]<span class="op">=</span><span class="dv">2</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">10</span>:<span class="dv">15</span>,<span class="dv">20</span>:<span class="dv">25</span>]<span class="op">=</span><span class="dv">3</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">10</span>,<span class="dv">20</span>]<span class="op">=</span><span class="dv">10</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>a[(ny<span class="op">//</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span>):(ny<span class="op">//</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span>),(nx<span class="op">//</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span>):(nx<span class="op">//</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span>)]<span class="op">=</span><span class="dv">10</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>rotang<span class="op">=</span><span class="dv">15</span> <span class="co"># rotation angle in degrees</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>axes<span class="op">=</span>test_rotate(a,rotang)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    plt.sca(ax)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    plt.clim([<span class="dv">0</span>,<span class="dv">4</span>])</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Regarding the lateral sampling, <code>reshape = False</code> keeps same number of points (and same sampling). <code>reshape = True</code> increases the number of points to cover the entire rotated data.</p>
<div class="cell" data-execution_count="233">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"shape of a:"</span>,a.shape)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"shapes of images data in figure:"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    plt.sca(ax)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ax.images[<span class="dv">0</span>].get_size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape of a: (50, 100)
shapes of images data in figure:
(50, 100)
(50, 100)
(74, 110)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ax1,ax2,ax3<span class="op">=</span>axes</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>a1,a2,a3<span class="op">=</span>[ax.images[<span class="dv">0</span>].get_array() <span class="cf">for</span> ax <span class="kw">in</span> axes]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reasonably, both methods should preserve We can verify how well they maintain pixel size. The single corner is marked with the out of range value of 10, that spreads to nearby pixel in interpolation.</p>
<div class="cell" data-execution_count="235">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ax1<span class="op">=</span>plt.subplot(<span class="dv">311</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plot_data(a1,vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="dv">17</span>,<span class="dv">25</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="dv">8</span>,<span class="dv">16</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"original; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>ax2<span class="op">=</span>plt.subplot(<span class="dv">312</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>plot_data(a2,vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim([<span class="dv">15</span>,<span class="dv">23</span>])</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">16</span>,<span class="dv">24</span>])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"reshape=0; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>ax3<span class="op">=</span>plt.subplot(<span class="dv">313</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>plot_data(a3,vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>ax3.set_xlim([<span class="dv">20</span>,<span class="dv">28</span>])</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>ax3.set_ylim([<span class="dv">28</span>,<span class="dv">36</span>])</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"reshape=1; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.95</span>])</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle("expected projected side lengths %.3f, %.3f"%(nx*np.cos(rotang*np.pi/180)+ny*np.sin(15*np.pi/180),ny*np.cos(rotang*np.pi/180)+nx*np.sin(rotang*np.pi/180)))</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Zoom from previous images"</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It was seen that sampling is preserved very well, this also reasonably maintains the amount of information, since density of information is maintained.</p>
<p>The rotated image has an integer number of pixels, that doesn’t match perfectly the non-integer positions of the rotated pixels (including corners). This can be taken care with interpolation, however it also poses some doubt about lateral registration. Notice that it is not easy to intuitively define the rotation center, most simply corresponds to a rotation about the center followed by x and y translations to bring the corners to 0. The ambiguity is in how the non-integer rotated coordinates are mapped to array indices: How does for example an interval of 109.534 (projected distance between rotated corners) maps to an integer distance of 109 pixels? Is it centered (accurate for center of rotation at array center) or aligned to the left?</p>
<p>Is the center calculated from min and max or from all four corners or from all pixels?</p>
<section id="step-by-step-rotate-function" class="level2">
<h2 class="anchored" data-anchor-id="step-by-step-rotate-function">Step by step rotate function</h2>
<p>These are the functions in pySurf that can be useful.</p>
<p>Use <code>rotate_points</code> as well tested reference:</p>
<div class="cell" data-execution_count="472">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.affine2D <span class="im">import</span> rotate_points, find_affine, rototrans_func</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rotate_points.__doc__,<span class="st">'</span><span class="ch">\n</span><span class="st">---</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(find_affine.__doc__,<span class="st">'</span><span class="ch">\n</span><span class="st">---</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rototrans_func.__doc__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>returns rotated coordinates of 2D point(s) x ([Npoints x 2]) about a center with anticlockwise angle theta in rad. If 3D points are passed, z coordinate is maintained. 
---

Return a function that can transform points from the first system to the second. 
    if pars is set to a list, append the matrix A of the transformation, that can be applied to a vector x with:
    unpad(np.dot(pad(x), A))
    markers1 and markers2 are sets of points in format [Npoints, Ndim]. Transformation matrix A is [Ndim+1 x Ndim+1].
    
    http://stackoverflow.com/questions/20546182/how-to-perform-coordinates-affine-transformation-using-python-part-2
     
---

return a function that rotate by theta about center THEN translate by offset</code></pre>
</div>
</div>
<div class="cell" data-execution_count="473">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#try to deal with x and y</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#establish data coordinates if not provided</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center in data coordinates</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>(xc,yc)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>step<span class="op">=</span>x[<span class="dv">1</span>]<span class="op">-</span>x[<span class="dv">0</span>],y[<span class="dv">1</span>]<span class="op">-</span>y[<span class="dv">0</span>] <span class="co">#this is kept constant with rotation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="474">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>np.arange(a3.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>y3<span class="op">=</span>np.arange(a3.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>corners3<span class="op">=</span><span class="bu">list</span>(product((x3[<span class="dv">0</span>],x3[<span class="op">-</span><span class="dv">1</span>]),(y3[<span class="dv">0</span>],y3[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>xc3,yc3<span class="op">=</span>span(corners3,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center of rotated image pixel index: </span><span class="ch">\n</span><span class="st">"</span>,xc3,yc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>center of rotated image pixel index: 
 54.5 36.5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="664">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reproduces rotate_data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#basic case: default rotate about xc,yc</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>a</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span><span class="va">None</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span><span class="va">None</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>args<span class="op">=</span>[]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>kwargs<span class="op">=</span>{}</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>fill_value<span class="op">=</span>np.nan</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>ang<span class="op">=</span><span class="dv">15</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>center<span class="op">=</span><span class="va">None</span> <span class="co">#(xc,yc)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#establish data coordinates if not provided</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center of data in data coordinates</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>(xc,yc)  </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>step<span class="op">=</span>x[<span class="dv">1</span>]<span class="op">-</span>x[<span class="dv">0</span>],y[<span class="dv">1</span>]<span class="op">-</span>y[<span class="dv">0</span>] <span class="co">#this is kept constant with rotation</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>a3<span class="op">=</span>ndimage.rotate(data,ang,reshape<span class="op">=</span><span class="dv">1</span>,cval<span class="op">=</span>fill_value,<span class="op">*</span>args,<span class="op">**</span>kwargs)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>np.arange(a3.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)<span class="op">*</span>step[<span class="dv">0</span>]</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>y3<span class="op">=</span>np.arange(a3.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)<span class="op">*</span>step[<span class="dv">1</span>]</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">#this is center of integer indices of rotated data, different from float center</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  of rotated corner span (can be calculated with matrix, see ipynb notebook</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>corners3<span class="op">=</span><span class="bu">list</span>(itertools.product((x3[<span class="dv">0</span>],x3[<span class="op">-</span><span class="dv">1</span>]),(y3[<span class="dv">0</span>],y3[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>xc3,yc3<span class="op">=</span>span(corners3,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>x0,y0<span class="op">=</span>np.matmul(([[np.cos(th),np.sin(th)],[<span class="op">-</span>np.sin(th),np.cos(th)]]),(np.array([xc,yc])<span class="op">-</span>center)).T</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co">#x0,y0=rotate_points((np.array([xc,yc])-center),ang*np.pi/180.,center=center) #rotation center transformed using points</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x0,y0)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>xout<span class="op">=</span>x3<span class="op">-</span>xc3<span class="op">+</span>x0<span class="op">+</span>center[<span class="dv">0</span>]  <span class="co">#(x3-xc3)*step[0]+center[0]</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>yout<span class="op">=</span>y3<span class="op">-</span>yc3<span class="op">+</span>y0<span class="op">+</span>center[<span class="dv">1</span>] <span class="co">#(y3-yc3)*step[1]+center[1]</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------    </span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center data original: "</span>,xc,yc)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center image coord rotated: "</span>,xc3,yc3)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"corners:"</span>,corners)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>ct<span class="op">=</span>rotate_points(corners,<span class="op">-</span>ang<span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>,center<span class="op">=</span>center) <span class="co">#corners transformed using points</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"rotated:"</span>,np.around(ct,decimals<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>xct,yct<span class="op">=</span>span(ct,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center of rotated corners: "</span>,xct,yct)</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="co">#d2,x2,y2=rotate_data(a,x,y,ang=15,center=center)</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>plot_data(a3,xout,yout) </span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>plt.plot(xc3,yc3,<span class="st">'+r'</span>)</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>plt.plot(x0,y0,<span class="st">'sb'</span>)</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0 0.0
center data original:  49.5 24.5
center image coord rotated:  54.5 36.5
corners: [(0.0, 0.0), (0.0, 49.0), (99.0, 0.0), (99.0, 49.0)]
rotated: [[ -4.65  13.65]
 [  8.03  60.98]
 [ 90.97 -11.98]
 [103.65  35.35]]
center of rotated corners:  49.5 24.5</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Note here pixels are centered on integer coordinates (pixel index).</p>
<div class="cell" data-execution_count="666">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="671">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>a</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span><span class="va">None</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span><span class="va">None</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>args<span class="op">=</span>[]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>kwargs<span class="op">=</span>{}</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>fill_value<span class="op">=</span>np.nan</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ang<span class="op">=</span><span class="dv">15</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#establish data coordinates if not provided</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center of data in data coordinates</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>(xc,yc)  </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>step<span class="op">=</span>x[<span class="dv">1</span>]<span class="op">-</span>x[<span class="dv">0</span>],y[<span class="dv">1</span>]<span class="op">-</span>y[<span class="dv">0</span>] <span class="co">#this is kept constant with rotation</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>a3<span class="op">=</span>ndimage.rotate(data,ang,reshape<span class="op">=</span><span class="dv">1</span>,cval<span class="op">=</span>fill_value,<span class="op">*</span>args,<span class="op">**</span>kwargs)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>np.arange(a3.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)<span class="op">*</span>step[<span class="dv">0</span>]</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>y3<span class="op">=</span>np.arange(a3.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)<span class="op">*</span>step[<span class="dv">1</span>]</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co">#this is center of integer indices of rotated data, different from float center</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="co">#  of rotated corner span (can be calculated with matrix, see ipynb notebook</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>corners3<span class="op">=</span><span class="bu">list</span>(itertools.product((x3[<span class="dv">0</span>],x3[<span class="op">-</span><span class="dv">1</span>]),(y3[<span class="dv">0</span>],y3[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>xc3,yc3<span class="op">=</span>span(corners3,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>th<span class="op">=</span>ang<span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="co">#rotate distance vector of rotation center from scipy center </span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>x0,y0<span class="op">=</span>np.matmul(([[np.cos(th),np.sin(th)],[<span class="op">-</span>np.sin(th),np.cos(th)]]),(np.array([xc,yc])<span class="op">-</span>center)).T</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">#x0,y0=rotate_points((np.array([xc,yc])-center),ang*np.pi/180.,center=center) #rotation center transformed using points</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x3,(xc3),x0,center[<span class="dv">0</span>])</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>xout<span class="op">=</span>x3<span class="op">-</span>(xc3)<span class="op">+</span>x0<span class="op">+</span>center[<span class="dv">0</span>]  <span class="co">#(x3-xc3)*step[0]+center[0]</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>yout<span class="op">=</span>y3<span class="op">-</span>(yc3)<span class="op">+</span>y0<span class="op">+</span>center[<span class="dv">1</span>] <span class="co">#(y3-yc3)*step[1]+center[1]</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------    </span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center data original: "</span>,xc,yc)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center image coord rotated: "</span>,xc3,yc3)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"corners:"</span>,corners)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>ct<span class="op">=</span>rotate_points(corners,<span class="op">-</span>ang<span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>,center<span class="op">=</span>center) <span class="co">#corners transformed using points</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"rotated:"</span>,np.around(ct,decimals<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>xct,yct<span class="op">=</span>span(ct,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center of rotated corners: "</span>,xct,yct)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co">#d2,x2,y2=rotate_data(a,x,y,ang=15,center=center)</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>plot_data(a3,xout,yout) </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>plt.plot(xc3,yc3,<span class="st">'+r'</span>)</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>plt.plot(x0,y0,<span class="st">'sb'</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[  0.   1.   2.   3.   4.   5.   6.   7.   8.   9.  10.  11.  12.  13.
  14.  15.  16.  17.  18.  19.  20.  21.  22.  23.  24.  25.  26.  27.
  28.  29.  30.  31.  32.  33.  34.  35.  36.  37.  38.  39.  40.  41.
  42.  43.  44.  45.  46.  47.  48.  49.  50.  51.  52.  53.  54.  55.
  56.  57.  58.  59.  60.  61.  62.  63.  64.  65.  66.  67.  68.  69.
  70.  71.  72.  73.  74.  75.  76.  77.  78.  79.  80.  81.  82.  83.
  84.  85.  86.  87.  88.  89.  90.  91.  92.  93.  94.  95.  96.  97.
  98.  99. 100. 101. 102. 103. 104. 105. 106. 107. 108. 109.] 54.5 32.247688029514066 20
center data original:  49.5 24.5
center image coord rotated:  54.5 36.5
corners: [(0.0, 0.0), (0.0, 49.0), (99.0, 0.0), (99.0, 49.0)]
rotated: [[ -1.91   5.52]
 [ 10.78  52.85]
 [ 93.72 -20.11]
 [106.4   27.22]]
center of rotated corners:  52.247688029514066 16.370762650667125</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>With <code>rotate_points</code> integer coordinates are not centered on pixels.</p>
<div class="cell" data-execution_count="668">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="678">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># basic test, rotate about 20,10</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>center,dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)  <span class="co">#baseline</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,x,y,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>center,dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-20-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-20-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-20-output-5.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="649">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#try to solve on rotate_data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>,nozoom<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="650">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="477">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test it is not altering rotation center:</p>
<div class="cell" data-execution_count="458">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xc,yc,rotate_points([[xc,yc]],<span class="op">-</span><span class="dv">15</span><span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>49.5 24.5 [[54.15439501 10.85364001]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="459">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xc,yc,rotate_points([[xc,yc]],<span class="op">-</span><span class="dv">15</span><span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>,center<span class="op">=</span>(xc,yc)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>49.5 24.5 [[49.5 24.5]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="460">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>x0,y0<span class="op">=</span><span class="dv">20</span>,<span class="dv">10</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x0,y0,rotate_points([[x0,y0]],<span class="op">-</span><span class="dv">15</span><span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>,center<span class="op">=</span>(x0,y0)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20 10 [[20. 10.]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="500">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>a</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span><span class="va">None</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span><span class="va">None</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>args<span class="op">=</span>[]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>kwargs<span class="op">=</span>{}</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>fill_value<span class="op">=</span>np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="501">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#establish data coordinates if not provided</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center of data in data coordinates</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>(xc,yc)  </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>step<span class="op">=</span>x[<span class="dv">1</span>]<span class="op">-</span>x[<span class="dv">0</span>],y[<span class="dv">1</span>]<span class="op">-</span>y[<span class="dv">0</span>] <span class="co">#this is kept constant with rotation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="502">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>a3<span class="op">=</span>ndimage.rotate(data,ang,reshape<span class="op">=</span><span class="dv">1</span>,cval<span class="op">=</span>fill_value,<span class="op">*</span>args,<span class="op">**</span>kwargs)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>np.arange(a3.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>y3<span class="op">=</span>np.arange(a3.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#this is center of integer indices of rotated data, different from float center</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  of rotated corner span (can be calculated with matrix, see ipynb notebook</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>corners3<span class="op">=</span><span class="bu">list</span>(itertools.product((x3[<span class="dv">0</span>],x3[<span class="op">-</span><span class="dv">1</span>]),(y3[<span class="dv">0</span>],y3[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>xc3,yc3<span class="op">=</span>span(corners3,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>th<span class="op">=</span>ang<span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>x0,y0<span class="op">=</span>np.matmul(([[np.cos(th),np.sin(th)],[<span class="op">-</span>np.sin(th),np.cos(th)]]),(np.array([xc,yc])<span class="op">-</span>center)).T</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#x0,y0=rotate_points((np.array([xc,yc])-center),ang*np.pi/180.,center=center) #rotation center transformed using points</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x0,y0)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>xout<span class="op">=</span>x3<span class="op">-</span>xc3<span class="op">+</span>x0<span class="op">+</span>center[<span class="dv">0</span>]  <span class="co">#(x3-xc3)*step[0]+center[0]</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>yout<span class="op">=</span>y3<span class="op">-</span>yc3<span class="op">+</span>y0<span class="op">+</span>center[<span class="dv">1</span>] <span class="co">#(y3-yc3)*step[1]+center[1]</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>ct<span class="op">=</span>rotate_points(corners,<span class="op">-</span>ang<span class="op">*</span>np.pi<span class="op">/</span><span class="fl">180.</span>,center<span class="op">=</span>center) <span class="co">#corners transformed using points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
</div>
<div class="cell" data-execution_count="503">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>plot_data(a)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>plt.clim([<span class="dv">0</span>,<span class="dv">4</span>])</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>d2,x2,y2<span class="op">=</span>rotate_data(a,x,y,<span class="dv">15</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>plot_data(d2,x2,y2)  </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.clim([<span class="dv">0</span>,<span class="dv">4</span>])</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0 0.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-30-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="504">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> plt.gcf().axes[::<span class="dv">2</span>]:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim((xc<span class="op">-</span>dx,xc<span class="op">+</span>dx))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim((yc<span class="op">-</span>dy,yc<span class="op">+</span>dy))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="505">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use ndimage to rotate data and recalculate coordinate </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#this assumes same center and non-integer coordinates are interpolated on integer cordinates </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   (in units of steps) </span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># default cval = 0.0 </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">a3=ndimage.rotate(data,ang,reshape=1)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#coordinates of rotated matplotlib center analytically calculated from original</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#in index coordinates of rotated data. Same as measure span between corners.   </span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">th=ang*np.pi/180</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">xc3,yc3=np.matmul(np.array([[np.cos(th),np.sin(th)],</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">                     [np.sin(th),np.cos(th)]]),np.array([xc,yc]))</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#rotated matplotlib coordinates as indices</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">x3=np.arange(a3.shape[1],dtype=float)</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">y3=np.arange(a3.shape[0],dtype=float)</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#output coordinates</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">xout=x3*step-xc3+xc</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">yout=y3*step-yc3+yc</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co">print("cane")</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot rotated corners over data. Rotation is about central point (middle point of coordinates span).</p>
<p>Corners are rotated with <code>rotate_points</code>, data with <code>ndimage.rotate</code>. corners coordinates are offset by <code>-xct+xc3</code> (and y..) to match matplotlib index, where <code>xct</code> is original center, and <code>xc3</code> center of rotated data in plotted data index space:</p>
<div class="cell" data-execution_count="506">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plt.figure(<span class="st">'match_corners'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ct[:,<span class="dv">0</span>]<span class="op">=</span>ct[:,<span class="dv">0</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>ct[:,<span class="dv">1</span>]<span class="op">=</span>ct[:,<span class="dv">1</span>]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plot_data(a3,vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.plot(ct[:,<span class="dv">0</span>]<span class="op">-</span>xct<span class="op">+</span>xc3,ct[:,<span class="dv">1</span>]<span class="op">-</span>yct<span class="op">+</span>yc3,<span class="st">'xr'</span>)  <span class="co">#translate ct to common center</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>plt.gca()</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="507">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#attempt to make ticks thick on cell borders and thin on points</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fails because major and minor grid overlap and thicker line prevails</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_xticks(np.arange(0, 101, 20))</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_xticks(minor_ticks, minor=True)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_yticks(np.arange(0, 101, 10))</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_yticks(minor_ticks, minor=True)</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># And a corresponding grid</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(which='both')</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Or if you want different settings for the grids:</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(which='minor', alpha=0.2)</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(which='major', alpha=0.5)</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_xticks(np.arange(0, 101, 1))</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_yticks(np.arange(0, 101, 1))</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_xticks(np.arange(0, 101, 0.5),minor=True)</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_yticks(np.arange(0, 101, 0.5),minor=True)</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Or if you want different settings for the grids:</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(which='minor', alpha=0.5, linestyle='solid', lw =2)</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(which='major', alpha=0.1, linestyle='dotted')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="508">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dx,dy<span class="op">=</span><span class="dv">2</span>,<span class="dv">2</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> ct:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    plt.xlim([c[<span class="dv">0</span>]<span class="op">-</span>dx<span class="op">-</span>xct<span class="op">+</span>xc3,c[<span class="dv">0</span>]<span class="op">+</span>dx<span class="op">-</span>xct<span class="op">+</span>xc3])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    plt.ylim([c[<span class="dv">1</span>]<span class="op">-</span>dy<span class="op">-</span>yct<span class="op">+</span>yc3,c[<span class="dv">1</span>]<span class="op">+</span>dy<span class="op">-</span>yct<span class="op">+</span>yc3])</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    plt.draw()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-37-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-37-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-37-output-4.png" class="img-fluid"></p>
</div>
</div>
<pre><code>from itertools import product

# use ndimage to rotate data and recalculate coordinate 
#this assumes same center and non-integer coordinates are interpolated on integer cordinates 
#   (in units of steps) 
# default cval = 0.0 
a3=ndimage.rotate(data,ang,reshape=1,cval=fill_value,*args,**kwargs)
x3=np.arange(a3.shape[1],dtype=float)
y3=np.arange(a3.shape[0],dtype=float)

#this is center of integer indices of rotated data, different from float center
#  of rotated corner span (can be calculated with matrix, see ipynb notebook
corners3=list(itertools.product((x3[0],x3[-1]),(y3[0],y3[-1])))
xc3,yc3=span(corners3,axis=0).mean(axis=0)

xout=(x3-xc3)*step[0]-xc+center[0]
yout=(y3-yc3)*step[1]-yc+center[1]</code></pre>
<div class="cell" data-execution_count="510">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>d2,x2,y2<span class="op">=</span>rotate_data(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>center)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plot_data(d2,x2,y2) </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xb'</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-38-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="511">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next plots show the results of this alignment applied to rotation about center of data, zoom on rotation center allows to verify centering:</p>
<p>Define above plots as function and apply to more generic cases:</p>
<div class="cell" data-execution_count="512">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproduce case #1 using function</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#test_rotate_center(a,ang=15)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rotate about hit pixel at (20,10)</p>
<div class="cell" data-execution_count="634">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">5</span>,dy<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-41-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>It should give same result using points (replot first reference result):</p>
<div class="cell" data-execution_count="514">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.data2D <span class="im">import</span> rotate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="515">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.points <span class="im">import</span> matrix_to_points2, plot_points, points_find_grid</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pySurf.points <span class="im">import</span> save_points, get_points, points_autoresample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="679">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_rotate_points(a,x<span class="op">=</span><span class="va">None</span>,y<span class="op">=</span><span class="va">None</span>,nozoom<span class="op">=</span><span class="va">False</span>,dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>,center<span class="op">=</span><span class="va">None</span>,scatter<span class="op">=</span><span class="va">False</span>,<span class="op">*</span>args,<span class="op">**</span>kwargs):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#dx,dy=2,2 #margin for zoom  </span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    crange<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">4</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#establish data coordinates if not provided</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center of data in data coordinates</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>        center<span class="op">=</span>(xc,yc)  </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>matrix_to_points2(a,x,y)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    theta<span class="op">=-</span>kwargs.pop(<span class="st">'ang'</span>,<span class="dv">0</span>)<span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    p2<span class="op">=</span>rotate_points(p,theta,center<span class="op">=</span>center,<span class="op">*</span>args,<span class="op">**</span>kwargs)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#this assumes same center and non-integer coordinates are interpolated on integer cordinates </span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   (in units of steps) </span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#xout,yout=points_find_grid(p2,result='grid',steps=(0,0))</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">#d2,x2,y2=points_autoresample(p2,steps=(0,0))</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#d2,x2,y2=rotate_data(a,x,y,*args,**kwargs)</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot original data</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">121</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    plot_points(p,scatter<span class="op">=</span>scatter)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    plt.clim(<span class="op">*</span>crange)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)    </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="dv">1</span>)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot rotated data</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">122</span>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    plot_points(p2,scatter<span class="op">=</span>scatter)  </span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    plt.clim(<span class="op">*</span>crange)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="dv">1</span>)</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    display(plt.gcf()) </span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> nozoom:</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">#zoom on rotation center</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>        xc,yc<span class="op">=</span> kwargs.get(<span class="st">'center'</span>,[span(p2[<span class="dv">0</span>,:]).mean(),span(p2[<span class="dv">1</span>,:]).mean()])</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ax <span class="kw">in</span> plt.gcf().axes[::<span class="dv">2</span>]:</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>            plt.sca(ax)</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>            plt.xlim((center[<span class="dv">0</span>]<span class="op">-</span>dx,center[<span class="dv">0</span>]<span class="op">+</span>dx))</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>            plt.ylim((center[<span class="dv">1</span>]<span class="op">-</span>dy,center[<span class="dv">1</span>]<span class="op">+</span>dy))</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>            plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="dv">1</span>)</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>            <span class="co">#ax.set_xlim((xc-dx,xc+dx))</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>            <span class="co">#ax.set_ylim((yc-dy,yc+dy))</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>        display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="680">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_rotate_center(a,x<span class="op">=</span><span class="va">None</span>,y<span class="op">=</span><span class="va">None</span>,nozoom<span class="op">=</span><span class="va">False</span>,dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>,center<span class="op">=</span><span class="va">None</span>,<span class="op">*</span>args,<span class="op">**</span>kwargs):</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#establish data coordinates if not provided</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>np.arange(data.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>np.arange(data.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    corners<span class="op">=</span><span class="bu">list</span>(itertools.product((x[<span class="dv">0</span>],x[<span class="op">-</span><span class="dv">1</span>]),(y[<span class="dv">0</span>],y[<span class="op">-</span><span class="dv">1</span>])))    </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)  <span class="co">#center of data in data coordinates</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>: <span class="co">#rotation center</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        center<span class="op">=</span>(xc,yc)  </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#dx,dy=2,2 #margin for zoom  </span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    crange<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">4</span>]</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    d2,x2,y2<span class="op">=</span>rotate_data(a,x,y,center<span class="op">=</span>center,<span class="op">*</span>args,<span class="op">**</span>kwargs)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot original data</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">121</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    plot_data(a,x,y)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    plt.clim(<span class="op">*</span>crange)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="dv">1</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot rotated data</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">122</span>)</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    plot_data(d2,x2,y2)  </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    plt.clim(<span class="op">*</span>crange)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="dv">1</span>)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    display(plt.gcf()) </span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> nozoom:</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">#zoom on rotation center</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>        xc,yc<span class="op">=</span> kwargs.get(<span class="st">'center'</span>,[span(x2).mean(),span(y2).mean()])</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ax <span class="kw">in</span> plt.gcf().axes[::<span class="dv">2</span>]:</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>            plt.sca(ax)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>            plt.xlim((center[<span class="dv">0</span>]<span class="op">-</span>dx,center[<span class="dv">0</span>]<span class="op">+</span>dx))</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>            plt.ylim((center[<span class="dv">1</span>]<span class="op">-</span>dy,center[<span class="dv">1</span>]<span class="op">+</span>dy))</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>            plt.plot(center[<span class="dv">0</span>],center[<span class="dv">1</span>],<span class="st">'xr'</span>)</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="dv">1</span>)</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>            <span class="co">#ax.set_xlim((xc-dx,xc+dx))</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">#ax.set_ylim((yc-dy,yc+dy))</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>        display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="684">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># basic test, rotate about 20,10</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)  <span class="co">#baseline</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-46-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-46-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-46-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-46-output-5.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="631">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#test scale</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,x<span class="op">*</span><span class="dv">2</span>,y<span class="op">*</span><span class="dv">3</span>,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">40</span>,<span class="dv">20</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,x<span class="op">*</span><span class="dv">2</span>,y<span class="op">*</span><span class="dv">3</span>,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">40</span>,<span class="dv">20</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>70.8364426640399 36.40670804541644</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-47-output-9.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="601">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>test_rotate_points(a,x<span class="op">*</span><span class="dv">2</span>,y<span class="op">*</span><span class="dv">3</span>,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">40</span>,<span class="dv">20</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,x<span class="op">*</span><span class="dv">2</span>,y<span class="op">*</span><span class="dv">3</span>,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">2</span>,dy<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Program Files (x86)\Microsoft Visual Studio\Shared\Anaconda3_64\lib\site-packages\matplotlib\pyplot.py:537: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).
  max_open_warning, RuntimeWarning)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-9.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>92.74314964084647 40.8895854062567</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-48-output-13.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="547">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>ax1<span class="op">=</span>plt.subplot(<span class="dv">311</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>plot_data(a1,vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlim([17,25])</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim([8,16])</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"original; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>ax2<span class="op">=</span>plt.subplot(<span class="dv">312</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>plot_data(<span class="op">*</span>rotate_data(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>)),vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_xlim([15,23])</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim([16,24])</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"reshape=0; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>ax3<span class="op">=</span>plt.subplot(<span class="dv">313</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>plot_data(<span class="op">*</span>rotate_data(a,x,y,ang<span class="op">=</span><span class="dv">15</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),usepoints<span class="op">=</span><span class="va">True</span>),vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ax3.set_xlim([20,28])</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ax3.set_ylim([28,36])</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"reshape=1; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="dv">1</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.95</span>])</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle("expected projected side lengths %.3f, %.3f"%(nx*np.cos(rotang*np.pi/180)+ny*np.sin(15*np.pi/180),ny*np.cos(rotang*np.pi/180)+nx*np.sin(rotang*np.pi/180)))</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Zoom from previous images"</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-49-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="568">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),dx<span class="op">=</span><span class="dv">5</span>,dy<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>32.247688029514066 6.370762650667128</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-50-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-50-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="569">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>),usepoints<span class="op">=</span><span class="va">True</span>,dx<span class="op">=</span><span class="dv">5</span>,dy<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-51-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-51-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="589">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>test_rotate_center(a,x,y,ang<span class="op">=</span><span class="fl">15.</span>,center<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>),dx<span class="op">=</span><span class="dv">5</span>,dy<span class="op">=</span><span class="dv">5</span>,nozoom<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>54.15439500632064 10.853640011507396</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-52-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#development test of rotate_data coordinates mapping</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>center<span class="op">=</span><span class="va">None</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>a</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>ang<span class="op">=</span><span class="dv">15</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>xc,yc<span class="op">=</span>span(corners,axis<span class="op">=</span><span class="dv">0</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> center <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>(xc,yc)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>step<span class="op">=</span>x[<span class="dv">1</span>]<span class="op">-</span>x[<span class="dv">0</span>],y[<span class="dv">1</span>]<span class="op">-</span>y[<span class="dv">0</span>] <span class="co">#this is kept constant with rotation</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># use ndimage to rotate data and recalculate coordinate </span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#this assumes same center and non-integer coordinates are interpolated on integer cordinates </span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   (in units of steps) </span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co"># default cval = 0.0 </span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>a3<span class="op">=</span>ndimage.rotate(data,ang,reshape<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co">#coordinates of rotated matplotlib center analytically calculated from original </span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>xc3,yc3<span class="op">=</span>np.matmul(np.array([[np.cos(th),np.sin(th)],</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>                     [np.sin(th),np.cos(th)]]),np.array([xc,yc]))</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co">#rotated matplotlib coordinates as indices</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>x3<span class="op">=</span>np.arange(a3.shape[<span class="dv">1</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>y3<span class="op">=</span>np.arange(a3.shape[<span class="dv">0</span>],dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co">#it would be better to obtain those by transformation of original corners and rescaling with steps as</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co">#done somewhere in notebook.</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="co">#corners3=list(itertools.product((x3[0],x3[-1]),(y3[0],y3[-1])))</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="co">#xc3,yc3=span(corners3,axis=0).mean(axis=1)</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>xout<span class="op">=</span>(x3<span class="op">-</span>xc3)<span class="op">*</span>step[<span class="dv">0</span>]<span class="op">+</span>xc</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>yout<span class="op">=</span>(y3<span class="op">-</span>yc3)<span class="op">*</span>step[<span class="dv">1</span>]<span class="op">+</span>yc</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"xout,yout:"</span> ,xout,yout)</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>th<span class="op">=</span>ang<span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Center from span of rotated corners:"</span>,</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>      xc3,yc3)</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a><span class="co"># note: np.dstack([a,b]).squeeze() with a and b 2el crashes kernel</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"center of mpl rotated data"</span>,</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>      span((np.matrix([[np.cos(th),np.sin(th)],[np.sin(th),np.cos(th)]])<span class="op">*</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>                np.asarray(corners).T).T,axis<span class="op">=</span><span class="dv">0</span>)[<span class="dv">1</span>]<span class="op">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>xout,yout: [ -4.65439501  -3.65439501  -2.65439501  -1.65439501  -0.65439501
   0.34560499   1.34560499   2.34560499   3.34560499   4.34560499
   5.34560499   6.34560499   7.34560499   8.34560499   9.34560499
  10.34560499  11.34560499  12.34560499  13.34560499  14.34560499
  15.34560499  16.34560499  17.34560499  18.34560499  19.34560499
  20.34560499  21.34560499  22.34560499  23.34560499  24.34560499
  25.34560499  26.34560499  27.34560499  28.34560499  29.34560499
  30.34560499  31.34560499  32.34560499  33.34560499  34.34560499
  35.34560499  36.34560499  37.34560499  38.34560499  39.34560499
  40.34560499  41.34560499  42.34560499  43.34560499  44.34560499
  45.34560499  46.34560499  47.34560499  48.34560499  49.34560499
  50.34560499  51.34560499  52.34560499  53.34560499  54.34560499
  55.34560499  56.34560499  57.34560499  58.34560499  59.34560499
  60.34560499  61.34560499  62.34560499  63.34560499  64.34560499
  65.34560499  66.34560499  67.34560499  68.34560499  69.34560499
  70.34560499  71.34560499  72.34560499  73.34560499  74.34560499
  75.34560499  76.34560499  77.34560499  78.34560499  79.34560499
  80.34560499  81.34560499  82.34560499  83.34560499  84.34560499
  85.34560499  86.34560499  87.34560499  88.34560499  89.34560499
  90.34560499  91.34560499  92.34560499  93.34560499  94.34560499
  95.34560499  96.34560499  97.34560499  98.34560499  99.34560499
 100.34560499 101.34560499 102.34560499 103.34560499 104.34560499] [-1.19767255e+01 -1.09767255e+01 -9.97672548e+00 -8.97672548e+00
 -7.97672548e+00 -6.97672548e+00 -5.97672548e+00 -4.97672548e+00
 -3.97672548e+00 -2.97672548e+00 -1.97672548e+00 -9.76725477e-01
  2.32745233e-02  1.02327452e+00  2.02327452e+00  3.02327452e+00
  4.02327452e+00  5.02327452e+00  6.02327452e+00  7.02327452e+00
  8.02327452e+00  9.02327452e+00  1.00232745e+01  1.10232745e+01
  1.20232745e+01  1.30232745e+01  1.40232745e+01  1.50232745e+01
  1.60232745e+01  1.70232745e+01  1.80232745e+01  1.90232745e+01
  2.00232745e+01  2.10232745e+01  2.20232745e+01  2.30232745e+01
  2.40232745e+01  2.50232745e+01  2.60232745e+01  2.70232745e+01
  2.80232745e+01  2.90232745e+01  3.00232745e+01  3.10232745e+01
  3.20232745e+01  3.30232745e+01  3.40232745e+01  3.50232745e+01
  3.60232745e+01  3.70232745e+01  3.80232745e+01  3.90232745e+01
  4.00232745e+01  4.10232745e+01  4.20232745e+01  4.30232745e+01
  4.40232745e+01  4.50232745e+01  4.60232745e+01  4.70232745e+01
  4.80232745e+01  4.90232745e+01  5.00232745e+01  5.10232745e+01
  5.20232745e+01  5.30232745e+01  5.40232745e+01  5.50232745e+01
  5.60232745e+01  5.70232745e+01  5.80232745e+01  5.90232745e+01
  6.00232745e+01  6.10232745e+01]
Center from span of rotated corners: 54.15439500632064 36.47672547665695
center of mpl rotated data [[54.15439501 36.47672548]]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="634">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>matrix_to_points2(a,x,y)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>plot_points(p)<span class="op">;</span>plt.show()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>rotate_points(p,<span class="op">-</span><span class="dv">15</span><span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi,center<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>plot_points(p)<span class="op">;</span>plt.show()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>res<span class="op">=</span>points_autoresample(p)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>plot_data(<span class="op">*</span>res)<span class="op">;</span>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>resampling...
resampling...</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rot01(img, angle, pivot):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://www.programcreek.com/python/example/93921/scipy.ndimage.rotate</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ex. nr. 1</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> np.array(pivot).astype(np.int32)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># double size of image while centering object</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    pads <span class="op">=</span> [[img.shape[<span class="dv">0</span>] <span class="op">-</span> pivot[<span class="dv">0</span>], pivot[<span class="dv">0</span>]], [img.shape[<span class="dv">1</span>] <span class="op">-</span> pivot[<span class="dv">1</span>], pivot[<span class="dv">1</span>]]]</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(img.shape) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        pads.append([<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    imgP <span class="op">=</span> np.pad(img, pads, <span class="st">'constant'</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reduce size of matrix to rotate around the object</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(img.shape) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        total_y <span class="op">=</span> np.<span class="bu">sum</span>(imgP.<span class="bu">any</span>(axis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">2</span>))) <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>        total_x <span class="op">=</span> np.<span class="bu">sum</span>(imgP.<span class="bu">any</span>(axis<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))) <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        total_y <span class="op">=</span> np.<span class="bu">sum</span>(imgP.<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>        total_x <span class="op">=</span> np.<span class="bu">sum</span>(imgP.<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)) <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    cropy <span class="op">=</span> <span class="bu">int</span>((imgP.shape[<span class="dv">0</span>] <span class="op">-</span> total_y)<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    cropx <span class="op">=</span> <span class="bu">int</span>((imgP.shape[<span class="dv">1</span>] <span class="op">-</span> total_x)<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    imgP[cropy:<span class="op">-</span>cropy, cropx:<span class="op">-</span>cropx] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>        ndimage.rotate(imgP[cropy:<span class="op">-</span>cropy, cropx:<span class="op">-</span>cropx], angle,</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>        reshape<span class="op">=</span><span class="va">False</span>, prefilter<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> imgP[pads[<span class="dv">0</span>][<span class="dv">0</span>]: <span class="op">-</span>pads[<span class="dv">0</span>][<span class="dv">1</span>], pads[<span class="dv">1</span>][<span class="dv">0</span>]: <span class="op">-</span>pads[<span class="dv">1</span>][<span class="dv">1</span>]] </span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="co">#from pySurf.instrumentReader import points_reader</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="co">#infolder=r'test\input_data\profilometer\04_test_directions'</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="co">#infile='07_xysurf_mp_Intensity.txt'</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="co">#data,x,y=points_reader(os.path.join(infolder,infile))</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>img<span class="op">=</span>a</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>angle<span class="op">=</span><span class="dv">30</span><span class="op">/</span><span class="dv">180</span><span class="op">*</span>np.pi</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>pivot<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>plot_data(a)</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>plt.clim([<span class="dv">0</span>,<span class="dv">2</span>])</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>d2<span class="op">=</span>rot01(a,<span class="dv">15</span>,np.array((<span class="dv">5</span>,<span class="dv">5</span>)))</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>plot_data(d2)  </span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"raw; xlim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">,ylim: </span><span class="sc">%.2f</span><span class="st">:</span><span class="sc">%.2f</span><span class="st">"</span><span class="op">%</span>(plt.xlim()<span class="op">+</span>plt.ylim()))</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>plt.clim([<span class="dv">0</span>,<span class="dv">2</span>])</span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-59-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>infolder<span class="op">=</span><span class="vs">r'input_data\profilometer\04_test_directions'</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#outfolder=r'test\profilometer_scans\04_test_directions_output'</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>outfolder<span class="op">=</span><span class="vs">r'results\test_points'</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>testfiles<span class="op">=</span>[<span class="st">'05_xysurf_pp_Intensity.txt'</span>,<span class="st">'06_xysurf_pm_Intensity.txt'</span>,<span class="st">'07_xysurf_mp_Intensity.txt'</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'08_xysurf_mm_Intensity.txt'</span>,<span class="st">'09_yxsurf_pp_Intensity.txt'</span>,<span class="st">'10_yxsurf_pm_Intensity.txt'</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'11_yxsurf_mp_Intensity.txt'</span>,<span class="st">'12_yxsurf_mm_Intensity.txt'</span>]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#definition for subplots</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span><span class="bu">len</span>(testfiles)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.floor(n<span class="op">**</span><span class="fl">0.5</span>).astype(<span class="bu">int</span>) <span class="co">#nr of plots on horizontal</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.ceil(<span class="fl">1.</span><span class="op">*</span>n<span class="op">/</span>a).astype(<span class="bu">int</span>) <span class="co">#nr of plots on vertical</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rotate-and-rebin" class="level2">
<h2 class="anchored" data-anchor-id="rotate-and-rebin">rotate and rebin</h2>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>pts2<span class="op">=</span>rotate_points(pts,<span class="dv">45</span><span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)  <span class="co">#rotate 45 degrees</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>pts3<span class="op">=</span>rebin_points(pts2,bins<span class="op">=</span>nbins)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>fig<span class="op">=</span>plt.figure(<span class="dv">8</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Rotate and rebin test'</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">131</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Original, scatter plot'</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>plot_points(pts,scatter<span class="op">=</span><span class="dv">1</span>,aspect<span class="op">=</span><span class="st">'equal'</span>)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>ax1<span class="op">=</span>plt.gca()</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">132</span>,sharex<span class="op">=</span>ax1,sharey<span class="op">=</span>ax1)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Rotated'</span>)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>plot_points(pts2,scatter<span class="op">=</span><span class="dv">1</span>,aspect<span class="op">=</span><span class="st">'equal'</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">133</span>,sharex<span class="op">=</span>ax1,sharey<span class="op">=</span>ax1)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Rotated and rebinned, scatterplot'</span>)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>plot_points(pts3,scatter<span class="op">=</span><span class="dv">1</span>,aspect<span class="op">=</span><span class="st">'equal'</span>)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>plt.savefig(os.path.join(outfolder,<span class="st">'08_rotateandrebin.png'</span>))</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>plt.close(<span class="st">'all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="256">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> misc</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage <span class="im">import</span> rotate</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>data_orig <span class="op">=</span> misc.face()</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>x0,y0 <span class="op">=</span> <span class="dv">580</span>,<span class="dv">300</span> <span class="co"># left eye; (xrot,yrot) should point there</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rot(image, xy, angle):</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    im_rot <span class="op">=</span> rotate(image,angle) </span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    org_center <span class="op">=</span> (np.array(image.shape[:<span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>])<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="fl">2.</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    rot_center <span class="op">=</span> (np.array(im_rot.shape[:<span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>])<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="fl">2.</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    org <span class="op">=</span> xy<span class="op">-</span>org_center</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.deg2rad(angle)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> np.array([org[<span class="dv">0</span>]<span class="op">*</span>np.cos(a) <span class="op">+</span> org[<span class="dv">1</span>]<span class="op">*</span>np.sin(a),</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span>org[<span class="dv">0</span>]<span class="op">*</span>np.sin(a) <span class="op">+</span> org[<span class="dv">1</span>]<span class="op">*</span>np.cos(a) ])</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> im_rot, new<span class="op">+</span>rot_center</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].imshow(data_orig,origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].scatter(x0,y0,c<span class="op">=</span><span class="st">"r"</span> )</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"original"</span>)</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, angle <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">66</span>,<span class="op">-</span><span class="dv">32</span>,<span class="dv">90</span>]):</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>    data_rot, (x1,y1) <span class="op">=</span> rot(data_orig, np.array([x0,y0]), angle)</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>    axes.flatten()[i<span class="op">+</span><span class="dv">1</span>].imshow(data_rot,origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>    axes.flatten()[i<span class="op">+</span><span class="dv">1</span>].scatter(x1,y1,c<span class="op">=</span><span class="st">"r"</span> )</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>    axes.flatten()[i<span class="op">+</span><span class="dv">1</span>].set_title(<span class="st">"Rotation: </span><span class="sc">{}</span><span class="st">deg"</span>.<span class="bu">format</span>(angle))</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>display(plt.gcf())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="test_rotate_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<pre><code>#PIL rotate
https://pillow.readthedocs.io/en/3.1.x/reference/Image.html
Image.rotate(angle, resample=0, expand=0)

Returns a rotated copy of this image. This method returns a copy of this image, rotated the given number of degrees counter clockwise around its centre.
Parameters: 

    angle – In degrees counter clockwise.
    resample – An optional resampling filter. This can be one of PIL.Image.NEAREST (use nearest neighbour), PIL.Image.BILINEAR (linear interpolation in a 2x2 environment), or PIL.Image.BICUBIC (cubic spline interpolation in a 4x4 environment). If omitted, or if the image has mode “1” or “P”, it is set PIL.Image.NEAREST.
    expand – Optional expansion flag. If true, expands the output image to make it large enough to hold the entire rotated image. If false or omitted, make the output image the same size as the input image.

Returns:    

An Image object.</code></pre>
<p>https://stackoverflow.com/questions/14163211/rotation-in-python-with-ndimage</p>
<p>SciPy’s rotate defaults to cubic spline interpolation, while PIL’s defaults to nearest neighbor. If you add the keyword parameter order=0 to SciPy, it should speed up considerably, and if you add filter=PIL.Image.BICUBIC (which is equivalent to filter=3) to PIL it will slow down. It is always a good idea to read the docs: docs.scipy.org/doc/scipy/reference/generated/… and pythonware.com/library/pil/handbook/image.htm</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>